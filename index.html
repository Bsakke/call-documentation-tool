<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Deck 2.0 - Call Documentation Tracker</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Floating Personal Notes Container -->
    <div id="floatingNotesContainer"></div>
    <button id="addFloatingNoteBtn" onclick="addFloatingNote()" style="position: fixed; top: 20px; right: 20px; z-index: 2000; background: #48bb78; color: white; border: none; border-radius: 6px; padding: 10px 18px; font-size: 16px; font-weight: 600; box-shadow: 0 2px 8px rgba(0,0,0,0.08); cursor: pointer;">+ Add Note</button>
    <div class="container">
        <header>
            <h1>Deck 2.0</h1>
            <button class="dark-mode-toggle" onclick="toggleDarkMode()">üåô Dark</button>
        </header>
        
        <div class="main-content">
            <!-- Weekly Schedule Sidebar -->
            <div class="schedule-sidebar" id="scheduleSidebar">
                <!-- Schedule Toggle Button (inside schedule) -->
                <button class="schedule-toggle-btn" id="scheduleToggleBtn" onclick="toggleScheduleSidebar()" title="Toggle Weekly Schedule">
                    <span class="schedule-handle" id="scheduleToggleIcon">‚ñ≤</span>
                </button>
                
                <div class="schedule-content" id="scheduleContent">
                    <div class="section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h2 style="margin: 0;">Weekly Schedule</h2>
                            <button onclick="openScheduleManager()" style="background: #805ad5; color: white; padding: 6px 10px; font-size: 12px;">Edit</button>
                        </div>
                        <div id="weeklyScheduleDisplay"></div>
                    </div>
                </div>
            </div>
            

            
            <div class="left-panel">
                <!-- Issue Category -->
                <div class="section">
                    <h2>Issue Category</h2>
                    <div class="field-group">
                        <label for="mainCategory">Main Category:</label>
                        <select id="mainCategory" onchange="updateSubcategoryDropdown()"></select>
                    </div>
                    <div class="field-group">
                        <label for="subCategory">Subcategory:</label>
                        <div class="combo-box-wrapper">
                            <input type="text" 
                                   id="subCategoryInput" 
                                   placeholder="Select or type new subcategory..." 
                                   oninput="handleSubcategoryInput()"
                                   onfocus="showSubcategoryDropdown()"
                                   onkeydown="handleSubcategoryKeydown(event)"
                                   autocomplete="off">
                            <button type="button" class="dropdown-arrow" onclick="toggleSubcategoryDropdown()" tabindex="-1">‚ñº</button>
                            <div id="subCategoryDropdown" class="custom-dropdown" style="display: none;"></div>
                        </div>
                    </div>
                    <div class="button-group">
                        <button onclick="openCategoryManager()" style="width: 100%; background: #805ad5; color: white;">Manage Categories</button>
                    </div>
                </div>
                
                <!-- Customer Info -->
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; cursor: pointer;" onclick="toggleCustomerSection()">
                        <h2 style="margin: 0;"><span id="customerSectionToggle">‚ñº</span> Customer Information</h2>
                        <button onclick="event.stopPropagation(); openCustomerFieldsManager()" style="background: #805ad5; color: white; padding: 8px 16px; font-size: 13px;">Manage Fields</button>
                    </div>
                    
                    <div id="customerFieldsSection">
                    <!-- Common fields for all categories -->
                    <div class="field-group">
                        <label for="firstName">First Name:</label>
                        <div class="field-with-copy">
                            <input type="text" id="firstName" placeholder="Enter first name" oninput="generateTemplate()">
                            <button class="copy-field-btn" tabindex="-1" onclick="copyField('firstName')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <label for="lastName">Last Name:</label>
                        <div class="field-with-copy">
                            <input type="text" id="lastName" placeholder="Enter last name" oninput="generateTemplate()">
                            <button class="copy-field-btn" tabindex="-1" onclick="copyField('lastName')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <label for="phoneNumber">Phone Number:</label>
                        <div class="field-with-copy">
                            <input type="text" id="phoneNumber" placeholder="Enter phone number" oninput="generateTemplate()">
                            <button class="copy-field-btn" tabindex="-1" onclick="copyField('phoneNumber')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <label for="email">Email:</label>
                        <div class="field-with-copy">
                            <input type="text" id="email" placeholder="Enter email address" oninput="generateTemplate()">
                            <button class="copy-field-btn" tabindex="-1" onclick="copyField('email')">Copy</button>
                        </div>
                    </div>
                    
                    <div class="field-group">
                        <label for="bpn">BPN:</label>
                        <div class="field-with-copy">
                            <input type="text" id="bpn" placeholder="Enter BPN" oninput="generateTemplate()">
                            <button class="copy-field-btn" tabindex="-1" onclick="copyField('bpn')">Copy</button>
                        </div>
                    </div>
                    
                    <!-- Custom fields container -->
                    <div id="customFieldsContainer"></div>
                    
                    <!-- K√§ytt√∂tuki-specific fields -->
                    <div id="kayttotukiFields" style="display: none;">
                        <div class="field-group">
                            <label for="ytunnus">Y-tunnus:</label>
                            <div class="field-with-copy">
                                <input type="text" id="ytunnus" placeholder="Enter Y-tunnus" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('ytunnus')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <label for="companyName">Company Name:</label>
                            <div class="field-with-copy">
                                <input type="text" id="companyName" placeholder="Enter company name" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('companyName')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                            <label style="color: var(--button-bg); font-size: 15px;">Secondary Contact Person</label>
                        </div>
                        
                        <div class="field-group">
                            <label for="contact2Name">Full Name:</label>
                            <div class="field-with-copy">
                                <input type="text" id="contact2Name" placeholder="Enter full name" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('contact2Name')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <label for="contact2Phone">Phone:</label>
                            <div class="field-with-copy">
                                <input type="text" id="contact2Phone" placeholder="Enter phone number" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('contact2Phone')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <label for="contact2Email">Email:</label>
                            <div class="field-with-copy">
                                <input type="text" id="contact2Email" placeholder="Enter email address" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('contact2Email')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                            <label style="color: var(--button-bg); font-size: 15px;">Ticket & ID Information</label>
                        </div>
                        
                        <div class="field-group">
                            <label for="ticketNumber1">Ticket Number 1:</label>
                            <div class="field-with-copy">
                                <input type="text" id="ticketNumber1" placeholder="e.g., TK-12345" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('ticketNumber1')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <label for="ticketNumber2">Ticket Number 2:</label>
                            <div class="field-with-copy">
                                <input type="text" id="ticketNumber2" placeholder="e.g., TK-67890" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('ticketNumber2')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <label for="id1">ID 1:</label>
                            <div class="field-with-copy">
                                <input type="text" id="id1" placeholder="Enter ID 1" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('id1')">Copy</button>
                            </div>
                        </div>
                        
                        <div class="field-group">
                            <label for="id2">ID 2:</label>
                            <div class="field-with-copy">
                                <input type="text" id="id2" placeholder="Enter ID 2" oninput="generateTemplate()">
                                <button class="copy-field-btn" tabindex="-1" onclick="copyField('id2')">Copy</button>
                            </div>
                        </div>
                    </div>
                    </div>
                </div>
                
                <!-- Time Tracking (Stopwatch) -->
                <div class="section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; cursor: pointer;" onclick="toggleStopwatchSection()">
                        <h2 style="margin: 0;"><span id="stopwatchSectionToggle">‚ñ∂</span> Time Tracking</h2>
                    </div>
                    
                    <div id="stopwatchSection" style="display: none;">
                        <div class="field-group">
                            <label for="stopwatchName">Task Name:</label>
                            <input type="text" id="stopwatchName" placeholder="Unique timer name" style="width: 100%;">
                        </div>
                        
                        <div style="text-align: center; margin: 20px 0;">
                            <div id="stopwatchDisplay" style="font-size: 48px; font-weight: bold; font-family: 'Courier New', monospace; color: var(--button-bg); margin-bottom: 15px;">00:00:00</div>
                            <div style="display: flex; gap: 10px; justify-content: center;">
                                <button id="stopwatchStartBtn" onclick="startStopwatch()" style="background: #48bb78; color: white; padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">‚ñ∂ Start</button>
                                <button id="stopwatchPauseBtn" onclick="pauseStopwatch()" disabled style="background: #ed8936; color: white; padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">‚è∏ Pause</button>
                                <button id="stopwatchResetBtn" onclick="resetStopwatch()" style="background: #f56565; color: white; padding: 10px 20px; border: none; border-radius: 6px; font-size: 14px; font-weight: 600; cursor: pointer;">‚èπ Reset</button>
                            </div>
                        </div>
                        
                        <div id="stopwatchHistory" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--border-color);">
                            <h3 style="margin-bottom: 10px; font-size: 14px; color: var(--text-secondary);">Recorded Sessions</h3>
                            <div id="stopwatchHistoryList" style="font-size: 13px; color: var(--text-primary);"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Call Time Tracker -->
                <div class="section">
                    <h2>Daily Call Time Tracker</h2>
                    <div class="time-tracker" style="margin-top: 15px;">
                        <div class="time-columns">
                            <div class="time-column">
                                <h3>Inbound Minutes</h3>
                                <div class="quick-minutes">
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('inbound', 1)">1</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('inbound', 2)">2</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('inbound', 3)">3</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('inbound', 4)">4</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('inbound', 5)">5</button>
                                </div>
                                <div id="inboundEntries"></div>
                            </div>
                            <div class="time-column">
                                <h3>Outbound Minutes</h3>
                                <div class="quick-minutes">
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('outbound', 1)">1</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('outbound', 2)">2</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('outbound', 3)">3</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('outbound', 4)">4</button>
                                    <button class="quick-min-btn" tabindex="-1" onclick="addQuickMinutes('outbound', 5)">5</button>
                                </div>
                                <div id="outboundEntries"></div>
                            </div>
                        </div>
                    </div>
                    <button class="log-call-btn" onclick="logCall()" style="margin-top: 20px;">‚úì Log This Call</button>
                    <button id="undoButton" onclick="undoLastCall()" style="display: none; margin-top: 10px; width: 100%; background: #fc8181; color: white; border: none; border-radius: 6px; padding: 10px; font-size: 14px; font-weight: 600; cursor: pointer;">
                        ‚Ü©Ô∏è Undo Last Call (60s)
                    </button>
                    <div class="daily-totals-section">
                        <h3 style="margin-bottom: 15px; color: var(--text-primary);">Daily Totals</h3>
                        <div class="total-time-card inbound-card">
                            <div class="total-label">Inbound</div>
                            <div class="total-value" id="inboundTotal">0 min</div>
                        </div>
                        <div class="total-time-card outbound-card">
                            <div class="total-label">Outbound</div>
                            <div class="total-value" id="outboundTotal">0 min</div>
                        </div>
                        <div class="total-time-card grand-total-card">
                            <div class="total-label">Total Today</div>
                            <div class="total-value" id="grandTotal">0 minutes</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="right-panel">
                <div class="section">
                    <h2>Summary</h2>
                    <small>Complete documentation ready to copy</small>
                    <div class="output-area" id="output">
                        <div style="padding: 40px; text-align: center; color: var(--text-secondary);">
                            <p>Your documentation summary will appear here...</p>
                            <p style="margin-top: 10px;">Fill in the details on the left to generate summary.</p>
                        </div>
                    </div>
                </div>
                
                <div class="stats-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">Today's Call Statistics</h2>
                        <button onclick="exportStats('today')" style="background: #48bb78; padding: 6px 12px; font-size: 12px;">Export</button>
                    </div>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Calls</th>
                                <th>Inbound</th>
                                <th>Outbound</th>
                                <th>Total</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBodyToday">
                            <tr>
                                <td colspan="6" style="text-align: center; color: var(--text-secondary);">No categories yet. Add subcategories to start tracking.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="stats-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h2 style="margin: 0;">All-Time Call Statistics</h2>
                        <button onclick="exportStats('alltime')" style="background: #48bb78; padding: 6px 12px; font-size: 12px;">Export</button>
                    </div>
                    <table class="stats-table">
                        <thead>
                            <tr>
                                <th>Category</th>
                                <th>Calls</th>
                                <th>Inbound</th>
                                <th>Outbound</th>
                                <th>Total</th>
                                <th>Avg/Call</th>
                                <th>%</th>
                            </tr>
                        </thead>
                        <tbody id="statsTableBodyAllTime">
                            <tr>
                                <td colspan="7" style="text-align: center; color: var(--text-secondary);">No categories yet. Add subcategories to start tracking.</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    
    <div class="copy-notification" id="copyNotification">
        ‚úì Copied to clipboard!
    </div>
    
    <!-- Weekly Schedule Manager Modal -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Weekly Schedule</h2>
                <button class="close-btn" onclick="closeScheduleManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 20px;">
                    <p style="color: var(--text-secondary); margin-bottom: 15px;">Set your work schedule for each day. Leave blank for days off.</p>
                </div>
                <div id="scheduleEditList"></div>
            </div>
            <div class="modal-footer">
                <button onclick="saveSchedule()" style="background: #48bb78; color: white;">Save Schedule</button>
                <button onclick="closeScheduleManager()" style="background: var(--text-secondary);">Cancel</button>
            </div>
        </div>
    </div>
    
    <!-- Customer Fields Manager Modal -->
    <div id="customerFieldsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Customer Fields</h2>
                <button class="close-btn" onclick="closeCustomerFieldsManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: var(--section-bg); padding: 15px; border-radius: 6px; margin-bottom: 20px; border: 1px solid var(--border-color);">
                    <h3 style="margin-top: 0;">Default Fields (Cannot be removed):</h3>
                    <ul style="margin: 10px 0; padding-left: 20px; color: var(--text-primary);">
                        <li>First Name</li>
                        <li>Last Name</li>
                        <li>Phone Number</li>
                        <li>Email</li>
                        <li>BPN</li>
                    </ul>
                </div>
                
                <h3>Custom Fields:</h3>
                <div id="customFieldsList" class="template-list"></div>
                
                <div class="add-template-section" style="margin-top: 20px;">
                    <h3>Add New Custom Field</h3>
                    <div class="form-group">
                        <label for="newFieldName">Field Name:</label>
                        <input type="text" id="newFieldName" placeholder="e.g., Company Name, Department">
                    </div>
                    <button onclick="addCustomField()" style="width: 100%;">Add Custom Field</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Category Manager Modal -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Manage Categories</h2>
                <button class="close-btn" onclick="closeCategoryManager()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="viewMainCategory">View Subcategories For:</label>
                    <select id="viewMainCategory" onchange="renderCategoryList()" style="width: 100%; padding: 10px; border: 2px solid var(--border-color); border-radius: 6px; background: var(--input-bg); color: var(--text-primary);">
                        <option value="">-- Select Main Category --</option>
                    </select>
                </div>
                
                <div class="template-list" id="categoryList"></div>
                
                <div class="add-template-section" style="margin-top: 20px;">
                    <h3>Add New Subcategory</h3>
                    <div class="form-group">
                        <label for="newSubcategoryName">Subcategory Name:</label>
                        <input type="text" id="newSubcategoryName" placeholder="e.g., Password Reset">
                    </div>
                    <div class="form-group">
                        <label for="newSubcategoryTemplate">Template (Optional):</label>
                        <textarea id="newSubcategoryTemplate" rows="6" placeholder="Enter template text here..."></textarea>
                    </div>
                    <button onclick="addNewSubcategory()" style="width: 100%;">Add Subcategory to Selected Category</button>
                </div>
                
                <div class="add-template-section" style="margin-top: 20px;">
                    <h3>Add New Main Category</h3>
                    <div class="form-group">
                        <label for="newMainCategoryName">Main Category Name:</label>
                        <input type="text" id="newMainCategoryName" placeholder="e.g., IT Support">
                    </div>
                    <button onclick="addNewMainCategory()" style="width: 100%;">Add Main Category</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>



